<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="estateMapper">

	<resultMap type="estate" id="estateResultSet">
		<result column="ES_NO" property="esNo"/>
		<result column="USER_NO" property="userNo"/>
		<result column="ES_NAME" property="esName"/>
		<result column="ES_CEO" property="esCeo"/>
		<result column="ES_PHONE" property="esPhone"/>
		<result column="ES_NUM" property="esNum"/>
		<result column="ES_REGISTER" property="esRegister"/>
		<result column="ES_REGISTER_NUM" property="esRegisterNum"/>
		<result column="ES_ADDRESS" property="esAddress"/>
		<result column="ES_CONTENT" property="esContent"/>
		
		<result column="ES_COUNT" property="esCount"/>
		<result column="ES_Status" property="esStatus"/>
		<result column="ENROLLDATE" property="enrollDate"/>
		<result column="ES_INTRO" property="esIntro"/>
		<association property="member" javaType="member">
        	<result column="CHANGE_NAME" property="changeName"/>
		</association>
	</resultMap>
	
	<select id="selectEstateList" parameterType="_int" resultMap="estateResultSet" >

	
	SELECT E.ES_NO
      ,E.ES_NAME
      ,M.CHANGE_NAME
      ,E.ES_INTRO
	FROM ESTATE E
	JOIN OWN O ON E.ES_NO = O.ES_NO
	JOIN MEMBER M ON E.USER_NO = M.USER_NO
	WHERE HOUSE_NO = #{houseNo}
	AND O.STATUS = 'Y'
	
	</select>
	
	<select id="estateDetail" parameterType="estate" resultMap="estateResultSet">
	 SELECT E.ES_NO
           ,E.USER_NO
           ,E.ES_NAME
           ,E.ES_CEO
           ,E.ES_PHONE
           ,E.ES_NUM
           ,E.ES_REGISTER_NUM
           ,E.ES_ADDRESS
           ,E.ES_CONTENT
           ,E.ENROLLDATE
           ,M.CHANGE_NAME
           ,E.ES_INTRO
	FROM ESTATE E
    JOIN MEMBER M ON E.USER_NO=M.USER_NO
	WHERE ES_NO=#{esNo}
	AND ES_STATUS = 'Y'
	</select>
	
	<update id="increaseCount" parameterType="_int">
	UPDATE ESTATE
    SET ES_COUNT = (ES_COUNT + 1)
    WHERE ES_STATUS = 'Y'
    AND ES_NO = #{esNo}
	</update>
	
	<select id="selectEstateLists" parameterType="estate" resultMap="estateResultSet">
	  	SELECT *
		FROM ESTATE 		
		ORDER BY ES_NO
	</select>
	
	<update id="banEstate" parameterType="estate">
  		UPDATE ESTATE
  		SET ES_STATUS = 'N'
  		WHERE ES_NO = #{esNo}
  		AND ES_STATUS = 'Y'
  	</update>
  		
  	<update id="permitEstate" parameterType="estate">
  		UPDATE ESTATE
  		SET ES_STATUS = 'Y'
  		WHERE ES_NO = #{esNo}
  		AND ES_STATUS = 'N'
  	</update>
	<select id="selectSubscribeEstateList" resultMap="estateResultSet">
		select user_no from estate e
		join member m using (user_no)
		where subscribe = 'Y'
	</select>

</mapper>
