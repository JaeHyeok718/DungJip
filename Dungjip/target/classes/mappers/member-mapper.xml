<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="memberMapper">
    
  		<resultMap type="member" id="memberResultSet">
  			<result column="USER_NO" property="userNo" />
  			<result column="USER_TYPE" property="userType"/>
  			<result column="USER_ID" property="userId"/>
    		<result column="USER_PWD" property="userPwd"/>
    		<result column="USER_NAME" property="userName"/>
    		<result column="USER_NICKNAME" property="userNickName"/>
    		<result column="AGE" property="age"/>
    		<result column="GENDER" property="gender"/>
    		<result column="EMAIL" property="email"/>
    		<result column="PHONE" property="phone"/>
    		<result column="ADDRESS" property="address"/>
    		<result column="PREFER_LOCATION" property="preferLocation"/>
    		<result column="PREFER_CHECK1" property="preferCheck1"/> 		
    		<result column="PREFER_CHECK2" property="preferCheck2"/>
    		<result column="PREFER_CHECK3" property="preferCheck3"/> 
    		<result column="STATUS" property="status"/>
    		<result column="ORIGIN_NAME" property="originName"/> 
    		<result column="CHANGE_NAME" property="changeName"/>    		
  		</resultMap>
  		
  		<resultMap type="estate" id="estateResultSet">  		
    		<result column="ES_NO" property="esNo"/>   		
  			<result column="USER_NO" property="userNo" />
  			<result column="ES_NAME" property="esName"/>
  			<result column="ES_CEO" property="esCeo"/>
    		<result column="ES_PHONE" property="esPhone"/>
    		<result column="ES_NUM" property="esNum"/>
    		<result column="ES_REGISTER_NUM" property="esRegisterNum"/>
    		<result column="ES_ADDRESS" property="esAddress"/>
    		<result column="ES_CONTENT" property="esContent"/>
    		<result column="ES_IMAGE" property="esImage"/>
    		<result column="ES_COUNT" property="esCount"/>
    		<result column="ES_STATUS" property="esStatus"/>
		
  		</resultMap>
  		
  		
  		<select id="loginMember" parameterType="member" resultMap="memberResultSet">
  			SELECT *
			FROM MEMBER
			WHERE USER_ID = #{userId}
 			AND STATUS = 'Y'
  		</select>
    	
    	<select id="ajaxIdMethod" resultType="_int">
    		SELECT COUNT(USER_ID) 
    		FROM MEMBER 
    		WHERE USER_ID = #{userId}    	
    	</select>	
  		
  		<insert id="insertMember" parameterType="member">
  			INSERT INTO MEMBER (USER_NO
  								,USER_TYPE                    
			                    ,USER_ID
			                    ,USER_PWD
			                    ,USER_NAME
			                    ,USER_NICKNAME
			                    ,EMAIL
			                    ,PHONE
			                    ,AGE
			                    ,GENDER
			                    ,ADDRESS
			                    ,ORIGIN_NAME
			                    ,CHANGE_NAME)
			VALUES(SEQ_MNO.NEXTVAL
					,#{userType}
					,#{userId}
					,#{userPwd}
					,#{userName}
					,#{userNickName}
					,#{email}
					,#{phone}
					,#{age}
					,#{gender}
					,#{address}
					,#{originName}
					,#{changeName}) 
  		</insert>
  		
  		<select id="selectMemberList" parameterType="member" resultMap="memberResultSet">
  			SELECT *
			FROM MEMBER 		
			ORDER BY USER_NO
  		</select>
  		
  		<select id="getNoticeByNo" resultType="member" resultMap="memberResultSet">
  			SELECT *
  			FROM MEMBER
  			WHERE USER_NO = #{userNo}
  		</select>
  		
  		<update id="banMember" parameterType="member">
  			UPDATE MEMBER
  			SET STATUS = 'N'
  			WHERE USER_NO = #{userNo}
  			AND STATUS = 'Y'
  		</update>
  		
  		<update id="permitMember" parameterType="member">
  			UPDATE MEMBER
  			SET STATUS = 'Y'
  			WHERE USER_NO = #{userNo}
  			AND STATUS = 'N'
  		</update>
  		
  		<insert id="esInsertMember" parameterType="member">
  			INSERT INTO MEMBER (USER_NO
  								,USER_TYPE                    
			                    ,USER_ID
			                    ,USER_PWD
			                    ,USER_NAME
			                    ,EMAIL
			                    ,PHONE
			                    ,AGE
			                    ,GENDER
			                    ,ADDRESS
			                    ,ORIGIN_NAME
			                    ,CHANGE_NAME)
			VALUES(SEQ_MNO.NEXTVAL
					,#{userType}
					,#{userId}
					,#{userPwd}
					,#{userName}
					,#{email}
					,#{phone}
					,#{age}
					,#{gender}
					,#{address}
					,#{originName}
					,#{changeName}) 		  		
  		</insert>
  		
  		<select id="esajaxIdMethod" resultType="_int">
    		SELECT COUNT(USER_ID) 
    		FROM MEMBER 
    		WHERE USER_ID = #{userId}    	
    	</select>
    	
    	<select id="exajaxphoneMethod" resultType="_int">
    		SELECT COUNT (PHONE)
			FROM MEMBER
			WHERE PHONE = #{phone}
    	</select>
    	
    	<select id="ajaxphoneMethod" resultType="_int">
    		SELECT COUNT (PHONE)
			FROM MEMBER
			WHERE PHONE = #{phone}
    	</select>
    	
    	<insert id="insertEsMember" parameterType="estate">
    		INSERT INTO ESTATE (ES_NO
    							,USER_NO
    							,ES_NAME
								,ES_CEO
								,ES_PHONE
								,ES_NUM
								,ES_REGISTER_NUM
								,ES_ADDRESS
								,ES_CONTENT)
			VALUES(SEQ_ENO.NEXTVAL
					,#{userNo}
					,#{esName}
					,#{esCeo}
					,#{esPhone}
					,#{esNum}
					,#{esRegisterNum}
					,#{esAddress}
					,#{esContent}) 		  	    	
    	</insert>	
    	
    	<select id="userNum" resultType="_int">
    		SELECT USER_NO
    		FROM MEMBER
    		WHERE USER_ID = #{userId}   	
    	</select>
    	
    	<select id="memberFindId" parameterType="member" resultMap="memberResultSet">
    		SELECT *
			FROM MEMBER 
			WHERE USER_NAME = #{userName}
			AND EMAIL = #{email}
    	</select>
    	
    	<select id="memberFindPwd" resultType="_int">
    		SELECT COUNT(*)
			FROM MEMBER 
			WHERE USER_NAME = #{userName}
			AND EMAIL = #{email}
			AND USER_ID = #{userId}
    	</select>
    	
    	<update id="updateMemberPwd">
    		UPDATE MEMBER
    		SET USER_PWD = #{userPwd}
    		WHERE USER_NAME = #{userName}
			AND EMAIL = #{email}
			AND USER_ID = #{userId}	    	
    	</update>
    	
    </mapper>